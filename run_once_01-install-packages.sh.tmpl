#!/bin/bash
# Install essential packages - runs once on first setup

set -e

echo "ðŸš€ Installing packages..."

{{ if eq .chezmoi.os "darwin" }}
# macOS - use Homebrew
if ! command -v brew &> /dev/null; then
    echo "ðŸ“¦ Installing Homebrew..."
    /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
fi

echo "ðŸ“¦ Installing packages via Homebrew..."
brew install \
    neovim \
    zellij \
    ripgrep \
    fd \
    fzf \
    git \
    lazygit \
    node \
    go \
    python3 \
    rust

{{ else if eq .chezmoi.os "linux" }}
# Linux - detect package manager
if command -v apt &> /dev/null; then
    echo "ðŸ“¦ Installing packages via apt..."
    sudo apt update
    sudo apt install -y \
        neovim \
        ripgrep \
        fd-find \
        fzf \
        git \
        nodejs \
        npm \
        golang \
        python3 \
        python3-pip

    # Install zellij (not in apt)
    if ! command -v zellij &> /dev/null; then
        echo "ðŸ“¦ Installing zellij..."
        cargo install zellij || {
            curl -L https://github.com/zellij-org/zellij/releases/latest/download/zellij-x86_64-unknown-linux-musl.tar.gz | tar xz -C /tmp
            sudo mv /tmp/zellij /usr/local/bin/
        }
    fi

elif command -v pacman &> /dev/null; then
    echo "ðŸ“¦ Installing packages via pacman..."
    sudo pacman -Syu --noconfirm \
        neovim \
        zellij \
        ripgrep \
        fd \
        fzf \
        git \
        nodejs \
        npm \
        go \
        python \
        python-pip \
        rustup

elif command -v dnf &> /dev/null; then
    echo "ðŸ“¦ Installing packages via dnf..."
    sudo dnf install -y \
        neovim \
        ripgrep \
        fd-find \
        fzf \
        git \
        nodejs \
        golang \
        python3 \
        python3-pip

    # Install zellij
    if ! command -v zellij &> /dev/null; then
        cargo install zellij
    fi
fi
{{ end }}

echo "âœ… Packages installed!"
