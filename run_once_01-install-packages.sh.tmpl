#!/bin/bash
# Install everything via mise - minimal system dependencies

set -e

echo "üöÄ Setting up development environment..."

# Install only essential system dependencies (git, curl)
{{ if eq .chezmoi.os "darwin" }}
# macOS - git and curl usually pre-installed via Xcode CLI tools
if ! command -v git &> /dev/null; then
    xcode-select --install 2>/dev/null || true
fi
{{ else if eq .chezmoi.os "linux" }}
if command -v apt &> /dev/null; then
    sudo apt update && sudo apt install -y git curl unzip
elif command -v pacman &> /dev/null; then
    sudo pacman -Syu --noconfirm git curl unzip
elif command -v dnf &> /dev/null; then
    sudo dnf install -y git curl unzip
fi
{{ end }}

# Install mise
echo "üì¶ Installing mise..."
if ! command -v mise &> /dev/null; then
    curl https://mise.run | sh
fi

# Add mise to PATH for this script
export PATH="$HOME/.local/bin:$PATH"

# Activate mise
eval "$(~/.local/bin/mise activate bash)"

# Install all tools via mise
echo "üì¶ Installing tools via mise..."

# Core tools
mise use --global neovim@latest
mise use --global ripgrep@latest
mise use --global fd@latest
mise use --global fzf@latest
mise use --global lazygit@latest
mise use --global zellij@latest

# Language runtimes
mise use --global node@lts
mise use --global python@3.12
mise use --global go@latest
mise use --global rust@latest

echo "‚úÖ All tools installed via mise!"
echo ""
echo "‚ö†Ô∏è  Restart your shell or run: source ~/.zshrc"
